import os
import unittest
from unittest.mock import patch

import pandas as pd

from src.d00_conf.conf import conf
from src.d02_preprocessing.OMA.preprocessing_hourly_oss import preprocessing_file, bh_computation, \
    split_hourly_file
from src.d02_preprocessing.tests import data_preprocessing_hourly

class TestBhComputation(unittest.TestCase):
    """
        Class to test bh_computation function come from
        src/d02_preprocessing/OMA/preprocessing_hourly_oss
    """

    def setUp(self):
        self.input_data = pd.DataFrame({
            'HOUR_DATE': ['2023-04-02 05:00', '2023-04-02 23:00', '2023-04-02 00:00',
                          '2023-04-02 00:00', '2023-04-02 03:00', '2023-04-02 14:00',
                          '2023-04-02 23:00', '2023-04-03 00:00', '2023-04-03 02:00',
                          '2023-04-03 16:00'],
            'CODE_ELT_ENODEB': ['RAB220_TDD', 'TAN933_TDD', 'MAR083_TDD', 'MAR101_TDD',
                                'KBG549_TDD', 'RAB165_TDD', 'JAD654_TDD', 'TAN933_TDD',
                                'RAB220_TDD', 'MAR101_TDD'],
            'FREQUENCY BAND': [42, 42, 42, 42, 42, 42, 42, 42, 42, 42],
            'CELL FDD TDD INDICATION': ['CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD',
                                        'CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD'],
            'CELL': ['RAB220_TDD_L4', 'TAN933_TDD_L2', 'MAR083_TDD_L4', 'MAR101_TDD_L5',
                     'KBG549_TDD_L6', 'RAB165_TDD_L6', 'JAD654_TDD_L6', 'TAN933_TDD_L2',
                     'RAB220_TDD_L4', 'MAR101_TDD_L5'],
            'LOCALCELL ID': [4, 2, 4, 5, 6, 6, 6, 2, 4, 5],
            'ENODEB FUNCTION NAME': ['RAB220_TDD', 'TAN933_TDD', 'MAR083_TDD', 'MAR101_TDD_OP',
                                     'KBG549_TDD', 'RAB165_TDD', 'JAD654_TDD_OP', 'TAN933_TDD',
                                     'RAB220_TDD', 'MAR101_TDD_OP'],
            'SECTOR ID': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'INTEGRITY': ['100%', '100%', '100%', '100%', '100%', '100%', '100%', '100%', '100%',
                          '100%'],
            'L.THRP.BITS.DL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.THRP.BITS.DL.QCI.7': [20136, 1773784, 411792, 299552, 396792, 166000, 11589224,
                                     810992, 20088, 331136],
            'L.THRP.BITS.DL.QCI.8': [234192.0, 9126208.0, 10760357528.0, 3779952.0, 5733805784.0,
                                     1054384.0, 666967848.0, 822720.0, 906432.0, 3561840.0],
            'L.THRP.BITS.DL.QCI.9': [9128573912.0, 15867720488.0, 3360250896.0, 21583250000.0,
                                     9644567200.0, 16683909696.0, 98836063656.0, 21179842008.0,
                                     12811856056.0, 10819732416.0],
            'L.THRP.BITS.DL.QCI.1': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.6': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.7': [51304, 2767344, 445504, 387480, 505032, 214648, 10276080,
                                     1192496, 44840, 429432],
            'L.THRP.BITS.UL.QCI.8': [217592.0, 2481944.0, 2398561336.0, 3656552.0, 127229048.0,
                                     1000624.0, 417130744.0, 820296.0, 857952.0, 5181008.0],
            'L.THRP.BITS.UL.QCI.9': [231649808, 745297472, 79249024, 1673654600, 348729976,
                                     2046463896, 5953128320, 1120721016, 137922056, 382480056],
            'L.THRP.BITS.UL.QCI.1': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.7': [0.0, 0.0005, 0.0001, 0.0001, 0.0001, 0.0001, 0.0083,
                                              0.0003, 0.0, 0.0001],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.8': [0.0001, 0.0031, 0.3358, 0.0026, 0.2655, 0.0012,
                                              0.0929, 0.001, 0.0002, 0.0022],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.9': [0.3612, 0.889, 0.0498, 0.7284, 0.4675, 0.4816, 6.4356,
                                              0.9317, 0.4113, 0.2798],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.E-RAB.SUCCEST': [250, 475, 363, 612, 2348, 405, 630, 270, 182, 981],
            'L.TRAFFIC.USER.VOIP.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.AVG': [3.7889, 19.0553, 7.1144, 24.7936, 20.1531, 10.4706, 45.6114,
                                   19.4817, 4.8063, 25.0108],
            'L.TRAFFIC.USER.PCELL.DL.AVG': [0.9511, 1.0, 2.0089, 0.0094, 0.0, 0.0, 0.0, 1.0, 0.9931,
                                            0.0],
            'L.TRAFFIC.USER.PCELL.DL.3CC.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.PCELL.DL.4CC.AVG': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.CHMEAS.PRB.DL.AVAIL': [100, 100, 100, 100, 100, 100, 100, 100, 100, 100],
            'L.CHMEAS.PRB.DL.USED.AVG': [8.6174, 90.1367, 34.9469, 62.7897, 24.7374, 61.0316,
                                         97.7017, 90.6903, 13.9473, 62.9474],
            'L.THRP.BITS.DL.LASTTTI.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.6': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.7': [20136, 1656680, 406120, 259640, 318688, 162456,
                                             11305856, 658912, 20088, 310808],
            'L.THRP.BITS.DL.LASTTTI.QCI.8': [78856.0, 6449072.0, 2924859192.0, 2866800.0,
                                             288182640.0, 961584.0, 84957144.0, 470064.0, 684392.0,
                                             3231864.0],
            'L.THRP.BITS.DL.LASTTTI.QCI.9': [202744368, 6365557408, 585795752, 9071327528,
                                             909206840, 4467953128, 17971041968, 6450079904,
                                             54525056, 3882914312],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.6': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.7': [0, 73, 3, 22, 38, 1, 503, 100, 0, 11],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.8': [16, 516, 503904, 279, 869843, 37, 86057, 87, 35,
                                                230],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.9': [1143289, 1646761, 78933, 737380, 1464375, 845812,
                                                15633599, 1971575, 1420967, 334723],
            'L.THRP.BITS.DL': [9152013600.0, 93015939768.0, 34596778184.0, 99949214664.0,
                               32382042976.0, 64337346912.0, 159285000000.0, 103592000000.0,
                               16072534584.0, 99706864752.0],
            'L.THRP.BITS.DL.LASTTTI': [204911896.0, 14735359688.0, 9556583040.0, 25197440392.0,
                                       5745429600.0, 13306188136.0, 24589054344.0, 18949544464.0,
                                       836617608.0, 27422292264.0],
            'L.THRP.TIME.DL.RMVLASTTTI': [1146167, 8774663, 2749191, 4112403, 5850653, 3929000,
                                          29277043, 10338683, 1778370, 4295165],
            'L.TRAFFIC.ACTIVEUSER.DL.AVG': [0.3637, 3.2586, 1.3635, 2.657, 2.0139, 1.7383, 11.3389,
                                            3.8742, 0.7033, 2.8838],
            'L.THRP.BITS.UL': [234149624.0, 2447769240.0, 4096210240.0, 4316755312.0, 1090928584.0,
                               4293171096.0, 10644131976.0, 3907436672.0, 456388672.0,
                               13509325184.0],
            'L.TRAFFIC.USER.MAX': [4, 23, 9, 29, 22, 15, 50, 21, 6, 30],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.7': [0.0, 0.0017, 0.0004, 0.0002, 0.0004, 0.0001, 0.0231,
                                              0.0017, 0.0, 0.0002],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.8': [0.0001, 0.0021, 0.255, 0.0081, 0.0524, 0.0008, 0.3123,
                                              0.0005, 0.0006, 0.0039],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.9': [0.1366, 0.4294, 0.0328, 0.7909999999999999, 0.1908,
                                              0.9470000000000001, 4.7117, 0.5531, 0.0776, 0.2143],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.TOTAL': [0.1376, 1.4637, 1.1943, 2.3144, 0.6866, 2.0428,
                                                  7.954, 2.0618, 0.1962, 2.5847],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.TOTAL.MAX': [4, 12, 6, 13, 10, 9, 27, 13, 4, 14],
            'L.TRAFFIC.ACTIVEUSER.UL.AVG': [0.1376, 1.4635, 1.1951, 2.3151, 0.687, 2.0428, 7.9524,
                                            2.0618, 0.1964, 2.5852],
            'L.TRAFFIC.ACTIVEUSER.AVG': [0.4085, 3.9051, 1.8313, 3.9687, 2.3361, 2.8866, 14.8985,
                                         4.9304, 0.8146, 4.1723],
            'L.TRAFFIC.ACTIVEUSER.DL.MAX': [4, 12, 6, 13, 10, 9, 27, 13, 4, 14],
            'L.CHMEAS.PRB.UL.USED.AVG': [17.9119, 38.6662, 40.5485, 41.6572, 29.5641, 65.9623,
                                         83.3085, 52.0647, 18.2832, 64.6035],
            'L.TRAFFIC.USER.PCELL.DL.5CC.AVG': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UE.UL.LASTTTI': [68884256, 657909360, 836030456, 1047688344, 389134312,
                                          441728576, 1674804392, 738115080, 165110904, 1420599368],
            'L.TRAFFIC.SCH.DL.NUM': [795125, 2765008, 2175665, 2406780, 2017395, 2174508, 2875032,
                                     2784136, 1480133, 2464946],
            'L.CHMEAS.PRB.UL.AVAIL': [100, 100, 100, 100, 100, 100, 100, 100, 100, 100],
            'L.THRP.TIME.UE.UL.RMVLASTTTI': [52590, 532402, 724094, 845561, 253284, 954022, 2866144,
                                             818018, 55125, 1128162],
            'L.TRAFFIC.SCH.UL.NUM': [286795, 718783, 713033, 719401, 633224, 687685, 719852, 719772,
                                     444747, 719654],
            'SECTOR': [4, 2, 4, 5, 6, 6, 6, 2, 4, 5],
            'FREQUENCY': [3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500, 3500],
            'CODE_ELT_CELL': ['RAB220_TDD_L4', 'TAN933_TDD_L2', 'MAR083_TDD_L4', 'MAR101_TDD_L5',
                              'KBG549_TDD_L6', 'RAB165_TDD_L6', 'JAD654_TDD_L6', 'TAN933_TDD_L2',
                              'RAB220_TDD_L4', 'MAR101_TDD_L5'],
            'ENODEB': ['RAB220_TDD', 'TAN933_TDD', 'MAR083_TDD', 'MAR101_TDD', 'KBG549_TDD',
                       'RAB165_TDD', 'JAD654_TDD', 'TAN933_TDD', 'RAB220_TDD', 'MAR101_TDD']})

        self.expected_output = pd.DataFrame({
            'HOUR_DATE': ['2023-04-02 23:00', '2023-04-03 00:00', '2023-04-02 03:00',
                          '2023-04-02 00:00', '2023-04-02 14:00', '2023-04-03 02:00',
                          '2023-04-02 00:00'],
            'CODE_ELT_ENODEB': ['JAD654_TDD', 'TAN933_TDD', 'KBG549_TDD', 'MAR101_TDD',
                                'RAB165_TDD', 'RAB220_TDD', 'MAR083_TDD'],
            'FREQUENCY BAND': [42, 42, 42, 42, 42, 42, 42],
            'CELL FDD TDD INDICATION': ['CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD',
                                        'CELL_TDD', 'CELL_TDD'],
            'CELL': ['JAD654_TDD_L6', 'TAN933_TDD_L2', 'KBG549_TDD_L6', 'MAR101_TDD_L5',
                     'RAB165_TDD_L6', 'RAB220_TDD_L4', 'MAR083_TDD_L4'],
            'LOCALCELL ID': [6, 2, 6, 5, 6, 4, 4],
            'ENODEB FUNCTION NAME': ['JAD654_TDD_OP', 'TAN933_TDD', 'KBG549_TDD', 'MAR101_TDD_OP',
                                     'RAB165_TDD', 'RAB220_TDD', 'MAR083_TDD'],
            'SECTOR ID': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'INTEGRITY': ['100%', '100%', '100%', '100%', '100%', '100%', '100%'],
            'L.THRP.BITS.DL.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.4': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.5': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.THRP.BITS.DL.QCI.7': [11589224, 810992, 396792, 299552, 166000, 20088, 411792],
            'L.THRP.BITS.DL.QCI.8': [666967848.0, 822720.0, 5733805784.0, 3779952.0, 1054384.0,
                                     906432.0, 10760357528.0],
            'L.THRP.BITS.DL.QCI.9': [98836063656.0, 21179842008.0, 9644567200.0, 21583250000.0,
                                     16683909696.0, 12811856056.0, 3360250896.0],
            'L.THRP.BITS.DL.QCI.1': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.4': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.5': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.6': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.7': [10276080, 1192496, 505032, 387480, 214648, 44840, 445504],
            'L.THRP.BITS.UL.QCI.8': [417130744.0, 820296.0, 127229048.0, 3656552.0, 1000624.0,
                                     857952.0, 2398561336.0],
            'L.THRP.BITS.UL.QCI.9': [5953128320, 1120721016, 348729976, 1673654600, 2046463896,
                                     137922056, 79249024],
            'L.THRP.BITS.UL.QCI.1': [0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.2': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.3': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.7': [0.0083, 0.0003, 0.0001, 0.0001, 0.0001, 0.0, 0.0001],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.8': [0.0929, 0.001, 0.2655, 0.0026, 0.0012, 0.0002,
                                              0.3358],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.9': [6.4356, 0.9317, 0.4675, 0.7284, 0.4816, 0.4113,
                                              0.0498],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.E-RAB.SUCCEST': [630, 270, 2348, 612, 405, 182, 363],
            'L.TRAFFIC.USER.VOIP.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.AVG': [45.6114, 19.4817, 20.1531, 24.7936, 10.4706, 4.8063, 7.1144],
            'L.TRAFFIC.USER.PCELL.DL.AVG': [0.0, 1.0, 0.0, 0.0094, 0.0, 0.9931, 2.0089],
            'L.TRAFFIC.USER.PCELL.DL.3CC.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.PCELL.DL.4CC.AVG': [0, 0, 0, 0, 0, 0, 0],
            'L.CHMEAS.PRB.DL.AVAIL': [100, 100, 100, 100, 100, 100, 100],
            'L.CHMEAS.PRB.DL.USED.AVG': [97.7017, 90.6903, 24.7374, 62.7897, 61.0316, 13.9473,
                                         34.9469],
            'L.THRP.BITS.DL.LASTTTI.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.4': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.5': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.6': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.7': [11305856, 658912, 318688, 259640, 162456, 20088,
                                             406120],
            'L.THRP.BITS.DL.LASTTTI.QCI.8': [84957144.0, 470064.0, 288182640.0, 2866800.0, 961584.0,
                                             684392.0, 2924859192.0],
            'L.THRP.BITS.DL.LASTTTI.QCI.9': [17971041968, 6450079904, 909206840, 9071327528,
                                             4467953128, 54525056, 585795752],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.4': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.5': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.6': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.7': [503, 100, 38, 22, 1, 0, 3],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.8': [86057, 87, 869843, 279, 37, 35, 503904],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.9': [15633599, 1971575, 1464375, 737380, 845812, 1420967,
                                                78933],
            'L.THRP.BITS.DL': [159285000000.0, 103592000000.0, 32382042976.0, 99949214664.0,
                               64337346912.0, 16072534584.0, 34596778184.0],
            'L.THRP.BITS.DL.LASTTTI': [24589054344.0, 18949544464.0, 5745429600.0, 25197440392.0,
                                       13306188136.0, 836617608.0, 9556583040.0],
            'L.THRP.TIME.DL.RMVLASTTTI': [29277043, 10338683, 5850653, 4112403, 3929000, 1778370,
                                          2749191],
            'L.TRAFFIC.ACTIVEUSER.DL.AVG': [11.3389, 3.8742, 2.0139, 2.657, 1.7383, 0.7033, 1.3635],
            'L.THRP.BITS.UL': [10644131976.0, 3907436672.0, 1090928584.0, 4316755312.0,
                               4293171096.0, 456388672.0, 4096210240.0],
            'L.TRAFFIC.USER.MAX': [50, 21, 22, 29, 15, 6, 9],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.7': [0.0231, 0.0017, 0.0004, 0.0002, 0.0001, 0.0, 0.0004],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.8': [0.3123, 0.0005, 0.0524, 0.0081, 0.0008, 0.0006,
                                              0.255],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.9': [4.7117, 0.5531, 0.1908, 0.7909999999999999,
                                              0.9470000000000001, 0.0776, 0.0328],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.TOTAL': [7.954, 2.0618, 0.6866, 2.3144, 2.0428, 0.1962,
                                                  1.1943],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.TOTAL.MAX': [27, 13, 10, 13, 9, 4, 6],
            'L.TRAFFIC.ACTIVEUSER.UL.AVG': [7.9524, 2.0618, 0.687, 2.3151, 2.0428, 0.1964, 1.1951],
            'L.TRAFFIC.ACTIVEUSER.AVG': [14.8985, 4.9304, 2.3361, 3.9687, 2.8866, 0.8146, 1.8313],
            'L.TRAFFIC.ACTIVEUSER.DL.MAX': [27, 13, 10, 13, 9, 4, 6],
            'L.CHMEAS.PRB.UL.USED.AVG': [83.3085, 52.0647, 29.5641, 41.6572, 65.9623, 18.2832,
                                         40.5485],
            'L.TRAFFIC.USER.PCELL.DL.5CC.AVG': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UE.UL.LASTTTI': [1674804392, 738115080, 389134312, 1047688344, 441728576,
                                          165110904, 836030456],
            'L.TRAFFIC.SCH.DL.NUM': [2875032, 2784136, 2017395, 2406780, 2174508, 1480133, 2175665],
            'L.CHMEAS.PRB.UL.AVAIL': [100, 100, 100, 100, 100, 100, 100],
            'L.THRP.TIME.UE.UL.RMVLASTTTI': [2866144, 818018, 253284, 845561, 954022, 55125,
                                             724094],
            'L.TRAFFIC.SCH.UL.NUM': [719852, 719772, 633224, 719401, 687685, 444747, 713033],
            'SECTOR': [6, 2, 6, 5, 6, 4, 4],
            'FREQUENCY': [3500, 3500, 3500, 3500, 3500, 3500, 3500],
            'CODE_ELT_CELL': ['JAD654_TDD_L6', 'TAN933_TDD_L2', 'KBG549_TDD_L6', 'MAR101_TDD_L5',
                              'RAB165_TDD_L6', 'RAB220_TDD_L4', 'MAR083_TDD_L4'],
            'ENODEB': ['JAD654_TDD', 'TAN933_TDD', 'KBG549_TDD', 'MAR101_TDD', 'RAB165_TDD',
                       'RAB220_TDD', 'MAR083_TDD']})
        self.tech = 'TDD'
        self.isp = 'HUAWEI'

    def test_bh_computation(self):
        result = bh_computation(self.input_data, self.tech, self.isp)
        pd.testing.assert_frame_equal(self.expected_output.reset_index(drop=True),
                                      result.reset_index(drop=True))

    def test_same_columns_bh_computation_huawei_tdd(self):
        result = bh_computation(self.input_data, self.tech, self.isp)
        self.assertTrue(self.expected_output.columns.equals(result.columns))

    def test_df_not_empty_huawei_tdd(self):
        result = bh_computation(self.input_data, self.tech, self.isp)
        self.assertTrue(not result.empty)


class TestPreprocessingFile(unittest.TestCase):
    """
    Class to test preprocessing_file function come from
    src/d02_preprocessing/OMA/preprocessing_hourly_oss
    """

    def setUp(self):
        self.tech = 'TDD'
        self.isp = 'HUAWEI'
        self.input_data = pd.DataFrame({
            'DATE': ['2023-04-02 05:00', '2023-04-02 23:00', '2023-04-02 00:00', '2023-04-02 00:00',
                     '2023-04-02 03:00', '2023-04-02 14:00', '2023-04-02 23:00', '2023-04-03 00:00',
                     '2023-04-03 02:00', '2023-04-03 16:00'],
            'ENODEB NAME': ['RAB220_TDD', 'TAN933_TDD', 'MAR083_TDD', 'MAR101_TDD', 'KBG549_TDD',
                            'RAB165_TDD', 'JAD654_TDD', 'TAN933_TDD', 'RAB220_TDD', 'MAR101_TDD'],
            'FREQUENCY BAND': [42, 42, 42, 42, 42, 42, 42, 42, 42, 42],
            'CELL FDD TDD INDICATION': ['CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD',
                                        'CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD', 'CELL_TDD'],
            'CELL NAME': ['RAB220_TDD_L4', 'TAN933_TDD_L2', 'MAR083_TDD_L4', 'MAR101_TDD_L5',
                          'KBG549_TDD_L6', 'RAB165_TDD_L6', 'JAD654_TDD_L6', 'TAN933_TDD_L2',
                          'RAB220_TDD_L4', 'MAR101_TDD_L5'],
            'LOCALCELL ID': [4, 2, 4, 5, 6, 6, 6, 2, 4, 5],
            'ENODEB FUNCTION NAME': ['RAB220_TDD', 'TAN933_TDD', 'MAR083_TDD', 'MAR101_TDD_OP',
                                     'KBG549_TDD', 'RAB165_TDD', 'JAD654_TDD_OP', 'TAN933_TDD',
                                     'RAB220_TDD', 'MAR101_TDD_OP'],
            'SECTOR ID': ['nan', 'nan', 'nan', 'nan', 'nan', 'nan', 'nan', 'nan', 'nan', 'nan'],
            'INTEGRITY': ['100%', '100%', '100%', '100%', '100%', '100%', '100%', '100%', '100%',
                          '100%'],
            'L.THRP.BITS.DL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.THRP.BITS.DL.QCI.7': [20136, 1773784, 411792, 299552, 396792, 166000, 11589224,
                                     810992, 20088, 331136],
            'L.THRP.BITS.DL.QCI.8': [234192.0, 9126208.0, 10760357528.0, 3779952.0, 5733805784.0,
                                     1054384.0, 666967848.0, 822720.0, 906432.0, 3561840.0],
            'L.THRP.BITS.DL.QCI.9': [9128573912.0, 15867720488.0, 3360250896.0, 21583250000.0,
                                     9644567200.0, 16683909696.0, 98836063656.0, 21179842008.0,
                                     12811856056.0, 10819732416.0],
            'L.THRP.BITS.DL.QCI.1': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.6': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.7': [51304, 2767344, 445504, 387480, 505032, 214648, 10276080,
                                     1192496, 44840, 429432],
            'L.THRP.BITS.UL.QCI.8': [217592.0, 2481944.0, 2398561336.0, 3656552.0, 127229048.0,
                                     1000624.0, 417130744.0, 820296.0, 857952.0, 5181008.0],
            'L.THRP.BITS.UL.QCI.9': [231649808, 745297472, 79249024, 1673654600, 348729976,
                                     2046463896, 5953128320, 1120721016, 137922056, 382480056],
            'L.THRP.BITS.UL.QCI.1': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.7': [0.0, 0.0005, 0.0001, 0.0001, 0.0001, 0.0001, 0.0083,
                                              0.0003, 0.0, 0.0001],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.8': [0.0001, 0.0031, 0.3358, 0.0026, 0.2655, 0.0012,
                                              0.0929, 0.001, 0.0002, 0.0022],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.9': [0.3612, 0.889, 0.0498, 0.7284, 0.4675, 0.4816, 6.4356,
                                              0.9317, 0.4113, 0.2798],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.E-RAB.SUCCEST': [250, 475, 363, 612, 2348, 405, 630, 270, 182, 981],
            'L.TRAFFIC.USER.VOIP.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.AVG': [3.7889, 19.0553, 7.1144, 24.7936, 20.1531, 10.4706, 45.6114,
                                   19.4817, 4.8063, 25.0108],
            'L.TRAFFIC.USER.PCELL.DL.AVG': [0.9511, 1.0, 2.0089, 0.0094, 0.0, 0.0, 0.0, 1.0, 0.9931,
                                            0.0],
            'L.TRAFFIC.USER.PCELL.DL.3CC.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.PCELL.DL.4CC.AVG': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.CHMEAS.PRB.DL.AVAIL': [100, 100, 100, 100, 100, 100, 100, 100, 100, 100],
            'L.CHMEAS.PRB.DL.USED.AVG': [8.6174, 90.1367, 34.9469, 62.7897, 24.7374, 61.0316,
                                         97.7017, 90.6903, 13.9473, 62.9474],
            'L.THRP.BITS.DL.LASTTTI.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.6': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.LASTTTI.QCI.7': [20136, 1656680, 406120, 259640, 318688, 162456,
                                             11305856, 658912, 20088, 310808],
            'L.THRP.BITS.DL.LASTTTI.QCI.8': [78856.0, 6449072.0, 2924859192.0, 2866800.0,
                                             288182640.0, 961584.0, 84957144.0, 470064.0, 684392.0,
                                             3231864.0],
            'L.THRP.BITS.DL.LASTTTI.QCI.9': [202744368, 6365557408, 585795752, 9071327528,
                                             909206840, 4467953128, 17971041968, 6450079904,
                                             54525056, 3882914312],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.4': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.5': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.6': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.7': [0, 73, 3, 22, 38, 1, 503, 100, 0, 11],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.8': [16, 516, 503904, 279, 869843, 37, 86057, 87, 35,
                                                230],
            'L.THRP.TIME.DL.RMVLASTTTI.QCI.9': [1143289, 1646761, 78933, 737380, 1464375, 845812,
                                                15633599, 1971575, 1420967, 334723],
            'L.THRP.BITS.DL': [9152013600.0, 93015939768.0, 34596778184.0, 99949214664.0,
                               32382042976.0, 64337346912.0, 159285000000.0, 103592000000.0,
                               16072534584.0, 99706864752.0],
            'L.THRP.BITS.DL.LASTTTI': [204911896.0, 14735359688.0, 9556583040.0, 25197440392.0,
                                       5745429600.0, 13306188136.0, 24589054344.0, 18949544464.0,
                                       836617608.0, 27422292264.0],
            'L.THRP.TIME.DL.RMVLASTTTI': [1146167, 8774663, 2749191, 4112403, 5850653, 3929000,
                                          29277043, 10338683, 1778370, 4295165],
            'L.TRAFFIC.ACTIVEUSER.DL.AVG': [0.3637, 3.2586, 1.3635, 2.657, 2.0139, 1.7383, 11.3389,
                                            3.8742, 0.7033, 2.8838],
            'L.THRP.BITS.UL': [234149624.0, 2447769240.0, 4096210240.0, 4316755312.0, 1090928584.0,
                               4293171096.0, 10644131976.0, 3907436672.0, 456388672.0,
                               13509325184.0],
            'L.TRAFFIC.USER.MAX': [4, 23, 9, 29, 22, 15, 50, 21, 6, 30],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.7': [0.0, 0.0017, 0.0004, 0.0002, 0.0004, 0.0001, 0.0231,
                                              0.0017, 0.0, 0.0002],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.8': [0.0001, 0.0021, 0.255, 0.0081, 0.0524, 0.0008, 0.3123,
                                              0.0005, 0.0006, 0.0039],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.9': [0.1366, 0.4294, 0.0328, 0.7909999999999999, 0.1908,
                                              0.947, 4.7117, 0.5531, 0.0776, 0.2143],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.TOTAL': [0.1376, 1.4637, 1.1943, 2.3144, 0.6866, 2.0428,
                                                  7.954, 2.0618, 0.1962, 2.5847],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.TOTAL.MAX': [4, 12, 6, 13, 10, 9, 27, 13, 4, 14],
            'L.TRAFFIC.ACTIVEUSER.UL.AVG': [0.1376, 1.4635, 1.1951, 2.3151, 0.687, 2.0428, 7.9524,
                                            2.0618, 0.1964, 2.5852],
            'L.TRAFFIC.ACTIVEUSER.AVG': [0.4085, 3.9051, 1.8313, 3.9687, 2.3361, 2.8866, 14.8985,
                                         4.9304, 0.8146, 4.1723],
            'L.TRAFFIC.ACTIVEUSER.DL.MAX': [4, 12, 6, 13, 10, 9, 27, 13, 4, 14],
            'L.CHMEAS.PRB.UL.USED.AVG': [17.9119, 38.6662, 40.5485, 41.6572, 29.5641, 65.9623,
                                         83.3085, 52.0647, 18.2832, 64.6035],
            'L.TRAFFIC.USER.PCELL.DL.5CC.AVG': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UE.UL.LASTTTI': [68884256, 657909360, 836030456, 1047688344, 389134312,
                                          441728576, 1674804392, 738115080, 165110904, 1420599368],
            'L.TRAFFIC.SCH.DL.NUM': [795125, 2765008, 2175665, 2406780, 2017395, 2174508, 2875032,
                                     2784136, 1480133, 2464946],
            'L.CHMEAS.PRB.UL.AVAIL': [100, 100, 100, 100, 100, 100, 100, 100, 100, 100],
            'L.THRP.TIME.UE.UL.RMVLASTTTI': [52590, 532402, 724094, 845561, 253284, 954022, 2866144,
                                             818018, 55125, 1128162],
            'L.TRAFFIC.SCH.UL.NUM': [286795, 718783, 713033, 719401, 633224, 687685, 719852, 719772,
                                     444747, 719654]})
        self.expected_output = pd.DataFrame({
            'HOUR_DATE': ['2023-04-02 23:00', '2023-04-03 00:00', '2023-04-02 03:00',
                          '2023-04-02 00:00', '2023-04-02 14:00', '2023-04-03 02:00',
                          '2023-04-02 00:00'],
            'CODE_ELT_ENODEB': ['JAD654_TDD', 'TAN933_TDD', 'KBG549_TDD', 'MAR101_TDD',
                                'RAB165_TDD', 'RAB220_TDD', 'MAR083_TDD'],
            'ENODEB': ['JAD654_TDD', 'TAN933_TDD', 'KBG549_TDD', 'MAR101_TDD', 'RAB165_TDD',
                       'RAB220_TDD', 'MAR083_TDD'],
            'SECTOR': [6, 2, 6, 5, 6, 4, 4],
            'CODE_ELT_CELL': ['JAD654_TDD_L6', 'TAN933_TDD_L2', 'KBG549_TDD_L6', 'MAR101_TDD_L5',
                              'RAB165_TDD_L6', 'RAB220_TDD_L4', 'MAR083_TDD_L4'],
            'CELL': ['JAD654_TDD_L6', 'TAN933_TDD_L2', 'KBG549_TDD_L6', 'MAR101_TDD_L5',
                     'RAB165_TDD_L6', 'RAB220_TDD_L4', 'MAR083_TDD_L4'],
            'FREQUENCY': [3500, 3500, 3500, 3500, 3500, 3500, 3500],
            'L.CHMEAS.PRB.DL.AVAIL': [100, 100, 100, 100, 100, 100, 100],
            'L.CHMEAS.PRB.DL.USED.AVG': [97.7017, 90.6903, 24.7374, 62.7897, 61.0316, 13.9473,
                                         34.9469],
            'L.CHMEAS.PRB.UL.AVAIL': [100, 100, 100, 100, 100, 100, 100],
            'L.CHMEAS.PRB.UL.USED.AVG': [83.3085, 52.0647, 29.5641, 41.6572, 65.9623, 18.2832,
                                         40.5485],
            'L.TRAFFIC.SCH.DL.NUM': [2875032, 2784136, 2017395, 2406780, 2174508, 1480133, 2175665],
            'L.TRAFFIC.SCH.UL.NUM': [719852, 719772, 633224, 719401, 687685, 444747, 713033],
            'L.THRP.BITS.DL.QCI.1': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.4': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.5': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.THRP.BITS.DL.QCI.7': [11589224, 810992, 396792, 299552, 166000, 20088, 411792],
            'L.THRP.BITS.DL.QCI.8': [666967848.0, 822720.0, 5733805784.0, 3779952.0, 1054384.0,
                                     906432.0, 10760357528.0],
            'L.THRP.BITS.DL.QCI.9': [98836063656.0, 21179842008.0, 9644567200.0, 21583250000.0,
                                     16683909696.0, 12811856056.0, 3360250896.0],
            'L.THRP.BITS.UL.QCI.1': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.4': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.5': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.6': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.UL.QCI.7': [10276080, 1192496, 505032, 387480, 214648, 44840, 445504],
            'L.THRP.BITS.UL.QCI.8': [417130744.0, 820296.0, 127229048.0, 3656552.0, 1000624.0,
                                     857952.0, 2398561336.0],
            'L.THRP.BITS.UL.QCI.9': [5953128320, 1120721016, 348729976, 1673654600, 2046463896,
                                     137922056, 79249024],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.2': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.3': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.7': [0.0083, 0.0003, 0.0001, 0.0001, 0.0001, 0.0, 0.0001],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.8': [0.0929, 0.001, 0.2655, 0.0026, 0.0012, 0.0002,
                                              0.3358],
            'L.TRAFFIC.ACTIVEUSER.DL.QCI.9': [6.4356, 0.9317, 0.4675, 0.7284, 0.4816, 0.4113,
                                              0.0498],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.1': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.2': [0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.3': [0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.4': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.5': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.6': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.7': [0.0231, 0.0017, 0.0004, 0.0002, 0.0001, 0.0, 0.0004],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.8': [0.3123, 0.0005, 0.0524, 0.0081, 0.0008, 0.0006,
                                              0.255],
            'L.TRAFFIC.ACTIVEUSER.UL.QCI.9': [4.7117, 0.5531, 0.1908, 0.7909999999999999, 0.947,
                                              0.0776, 0.0328],
            'L.TRAFFIC.USER.AVG': [45.6114, 19.4817, 20.1531, 24.7936, 10.4706, 4.8063, 7.1144],
            'L.TRAFFIC.USER.VOIP.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.PCELL.DL.AVG': [0.0, 1.0, 0.0, 0.0094, 0.0, 0.9931, 2.0089],
            'L.TRAFFIC.USER.PCELL.DL.3CC.AVG': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
            'L.TRAFFIC.USER.PCELL.DL.4CC.AVG': [0, 0, 0, 0, 0, 0, 0],
            'L.TRAFFIC.USER.PCELL.DL.5CC.AVG': [0, 0, 0, 0, 0, 0, 0],
            'L.THRP.BITS.DL': [159285000000.0, 103592000000.0, 32382042976.0, 99949214664.0,
                               64337346912.0, 16072534584.0, 34596778184.0],
            'L.THRP.BITS.DL.LASTTTI': [24589054344.0, 18949544464.0, 5745429600.0, 25197440392.0,
                                       13306188136.0, 836617608.0, 9556583040.0],
            'L.THRP.TIME.DL.RMVLASTTTI': [29277043, 10338683, 5850653, 4112403, 3929000, 1778370,
                                          2749191],
            'L.THRP.BITS.UL': [10644131976.0, 3907436672.0, 1090928584.0, 4316755312.0,
                               4293171096.0, 456388672.0, 4096210240.0],
            'L.THRP.BITS.UE.UL.LASTTTI': [1674804392, 738115080, 389134312, 1047688344, 441728576,
                                          165110904, 836030456],
            'L.THRP.TIME.UE.UL.RMVLASTTTI': [2866144, 818018, 253284, 845561, 954022, 55125,
                                             724094],
            'L.TRAFFIC.USER.MAX': [50, 21, 22, 29, 15, 6, 9]})

    def test_preprocessing_file_huawei_tdd(self):
        result = preprocessing_file(self.input_data, self.tech, self.isp)
        pd.testing.assert_frame_equal(self.expected_output.reset_index(drop=True),
                                      result.reset_index(drop=True))

    def test_same_columns_preprocessing_file_huawei_tdd(self):
        result = preprocessing_file(self.input_data, self.tech, self.isp)
        self.assertTrue(self.expected_output.columns.equals(result.columns))

    def test_df_not_empty_huawei_tdd(self):
        result = preprocessing_file(self.input_data, self.tech, self.isp)
        self.assertTrue(not result.empty)


class TestSplitHourlyFile(unittest.TestCase):
    @patch('pandas.DataFrame.to_csv')
    @patch('pandas.read_csv')
    def test_split_hourly_file(self, mock_read_csv, mock_to_csv):
        mock_read_csv.side_effect = lambda path: data_preprocessing_hourly.path_to_df[path]
        split_hourly_file()
        mock_to_csv.assert_called_with(os.path.join(conf["PATH"]["RAW_DATA"], 'OSS_4G', 'TDD',
                                                    'TDD_raw_oss.csv'), sep="|", index=False)





if __name__ == '__main__':
    unittest.main()
